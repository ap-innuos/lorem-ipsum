<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Innuos</title>
    <script src="https://www.gstatic.com/cast/sdk/libs/caf_receiver/v3/cast_receiver_framework.js"></script>
    <!-- Cast Debug Logger -->
    <script src="https://www.gstatic.com/cast/sdk/libs/devtools/debug_layer/caf_receiver_logger.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.8.1/socket.io.js" integrity="sha512-8BHxHDLsOHx+flIrQ0DrZcea7MkHqRU5GbTHmbdzMRnAaoCIkZ97PqZcXJkKZckMMhqfoeaJE+DNUVuyoQsO3Q==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #1a1a1a;
            color: white;
            margin: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        #loading,
        #error,
        .content {
            display: none;
        }

        #loading.active,
        #error.active,
        .content.active {
            display: flex;
        }

        #loading {
            font-size: 2em;
        }

        #error {
            font-size: 2em;
            color: red;
        }

        .content {
            flex-direction: row;
            justify-content: center;
            align-items: center;
            width: 90%;
            max-width: 1200px;
        }

        #album-art {
            width: 60%;
            max-width: 400px;
            height: auto;
            border-radius: 12px;
        }

        .info {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: flex-start;
            margin-left: 30px;
            max-width: 50%;
        }

        .info h3 {
            font-size: 3vw;
            margin: 10px 0;
        }

        .play-icon {
            margin-top: 60px;
            text-align: center;
        }

        .material-icons {
            font-size: 8vw;
            color: white;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <div id="loading" class="active">Loading...</div>
    <div id="error">Error: Unable to load song data</div>

    <div class="content">
        <img id="album-art" src="https://static.qobuz.com/images/covers/6a/gy/x95616fwfgy6a_600.jpg" alt="Album Art">
        <div class="info">
            <div id="song-title">
                <h3>Can't Get Out Of This Mood</h3>
            </div>
            <div id="artist-name">
                <h3>Samara Joy</h3>
            </div>
        </div>
        <div class="play-icon">
            <i class="material-icons">play_circle_outline</i>
        </div>
    </div>

    <script>
        const loadingScreen = document.getElementById('loading');
        const errorScreen = document.getElementById('error');
        const contentScreen = document.querySelector('.content');

        // Updated to use HTTPS connection for Socket.IO
        const playerSocket = io('https://192.168.1.200:3000/'); // Replace with your HTTPS server domain and port

        playerSocket.on("connect", () => {
            console.log('-> Player connected');
        });

        playerSocket.on("player_status", newPlayerState => {
            console.log("Received player status:", newPlayerState);
            const playerObject = newPlayerState.player_loop['4c:38:d5:15:52:7e'];

            if (playerObject && playerObject.track) {
                const title = playerObject.track.title;
                const artist = playerObject.track.artist[0]?.name || "Unknown Artist";
                const cover = playerObject.track.cover;

                if (title && artist && cover) {
                    document.getElementById("song-title").querySelector("h3").textContent = title;
                    document.getElementById("artist-name").querySelector("h3").textContent = artist;
                    document.getElementById("album-art").src = cover;

                    loadingScreen.classList.remove('active');
                    errorScreen.classList.remove('active');
                    contentScreen.classList.add('active');
                } else {
                    showError();
                }
            } else {
                showError();
            }
        });

        function showError() {
            loadingScreen.classList.remove('active');
            contentScreen.classList.remove('active');
            errorScreen.classList.add('active');
        }
    </script>
</body>

</html>
